<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Image Validator</title>
    <script>
        function updateSelectionLimit() {
            // Get all checkboxes
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            // Count selected checkboxes
            const selectedCount = Array.from(checkboxes).filter(checkbox => checkbox.checked).length;
            // Enable or disable checkboxes based on selection
            checkboxes.forEach(checkbox => {
                if (selectedCount >= 4) {
                    if (!checkbox.checked) {
                        checkbox.disabled = true;
                    }
                } else {
                    checkbox.disabled = false;
                }
            });
        }
    </script>
</head>
<body>
    {% if images %}
    <h1>Validating Images for: {{ product['title'] }}</h1>
    <p>Select exactly 4 images to complete the set.</p>
    <form method="POST" action="{{ url_for('validate') }}">
        {% for image in images %}
        <div style="display: inline-block; margin: 10px;">
            <img src="{{ url_for('static', filename='product_images/' + product['title'].replace(' ', '_').lower() + '/' + image) }}"
                 alt="Image" width="150">
            <br>
            <label>
                <input type="checkbox" name="images" value="{{ image }}"> Select
            </label>
        </div>
        {% endfor %}
        <br>
        <button type="submit">Submit</button>
    </form>
    <script>
        // Disable the submit button if fewer than 4 images are selected
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
                document.getElementById('submit-btn').disabled = selectedCount !== 4;
            });
        });
    </script>
    {% else %}
    <h1>Loading Images for: {{ product }}</h1>
    <div style="text-align: center;">
        <p>Please wait while we fetch the images...</p>
    </div>
    <script>
        setTimeout(function() {
            window.location.reload();
        }, 5000); // Refresh the page every 5 seconds if images aren't ready
    </script>
    {% endif %}
</body>
</html>